#!/bin/bash

# 加拿大快递邮编展示系统 - Windows兼容版本打包脚本
# 作者: Canada Postal Delivery System
# 日期: 2025-06-06
# 版本: v2.0 - 多架构兼容版

echo "🚀 开始创建Windows兼容版本发布包..."

# 创建发布目录
RELEASE_DIR="Windows_兼容版_$(date +%Y%m%d_%H%M)"
mkdir -p "$RELEASE_DIR"

echo "📦 正在复制文件..."

# 复制通用安装包（包含x64和ia32）
echo "  ├── 复制通用安装包..."
cp "dist-electron/加拿大快递邮编展示系统 Setup 1.0.0.exe" "$RELEASE_DIR/【推荐】加拿大快递邮编展示系统_安装包.exe"

# 复制x64绿色版本
echo "  ├── 复制64位绿色版本..."
cp -r "dist-electron/win-unpacked" "$RELEASE_DIR/绿色版_64位_推荐"

# 复制32位绿色版本
echo "  ├── 复制32位绿色版本..."
cp -r "dist-electron/win-ia32-unpacked" "$RELEASE_DIR/绿色版_32位_兼容"

# 创建详细的使用说明
cat > "$RELEASE_DIR/📋Windows使用指南_请先阅读.txt" << 'EOF'
=======================================================
  🏆 加拿大快递邮编展示系统 - Windows兼容版
=======================================================

🎯 选择适合您电脑的版本：

┌─────────────────────────────────────────────────────┐
│                  ⭐ 推荐方案                        │
├─────────────────────────────────────────────────────┤
│ 文件: 【推荐】加拿大快递邮编展示系统_安装包.exe      │
│ 说明: 智能安装包，自动检测系统架构                   │
│ 优点: 一键安装，自动适配，创建快捷方式               │
│ 使用: 双击运行，按向导安装即可                       │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│                  🖥️ 绿色版选择                      │
├─────────────────────────────────────────────────────┤
│ 如果您知道电脑架构，可以选择对应的绿色版本：         │
│                                                     │
│ 📁 绿色版_64位_推荐/                                │
│    适用: Windows 10/11 (64位) - 大多数现代电脑      │
│    性能: 最佳性能和兼容性                           │
│                                                     │
│ 📁 绿色版_32位_兼容/                                │
│    适用: 较老的Windows系统或32位系统                │
│    兼容: 更广泛的硬件兼容性                         │
└─────────────────────────────────────────────────────┘

🔍 如何判断您的系统架构？
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
方法1: 按 Win + R，输入 msinfo32，查看"系统类型"
方法2: 右键"此电脑" → 属性 → 查看"系统类型"
方法3: 如果不确定，直接使用【推荐】安装包

💡 启动说明：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. 启动应用后，请等待3-5秒完成初始化
2. 地图数据需要网络连接进行加载
3. 首次使用建议先浏览一下左侧的功能面板

⚠️ 常见问题解决：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
问题: 双击无反应或报错
解决: 
  1. 确认选择了正确的架构版本
  2. 以管理员身份运行
  3. 检查Windows Defender是否拦截
  4. 尝试在英文路径下运行

问题: 应用启动后显示空白
解决:
  1. 检查网络连接
  2. 等待更长时间（最多30秒）
  3. 重启应用

📞 技术支持：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
如遇到问题，请提供以下信息：
- Windows版本 (如: Windows 10 64位)
- 选择的应用版本
- 具体错误信息或现象

=======================================================
EOF

# 创建每个版本的专门说明
cat > "$RELEASE_DIR/绿色版_64位_推荐/🚀双击这里启动.txt" << 'EOF'
🎯 64位版本启动说明

1. 双击运行: 加拿大快递邮编展示系统.exe
2. 等待启动 (约3-5秒)
3. 开始使用!

💻 适用系统: Windows 10/11 (64位)
⚡ 性能: 最佳
📈 推荐度: ⭐⭐⭐⭐⭐
EOF

cat > "$RELEASE_DIR/绿色版_32位_兼容/🔧兼容版启动说明.txt" << 'EOF'
🎯 32位版本启动说明

1. 双击运行: 加拿大快递邮编展示系统.exe  
2. 等待启动 (约5-10秒)
3. 开始使用!

💻 适用系统: Windows 7/8/10/11 (32位或64位)
🔧 兼容性: 最佳
📈 推荐度: ⭐⭐⭐⭐ (性能略低但兼容性更好)
EOF

# 重命名exe文件使其更明显
mv "$RELEASE_DIR/绿色版_64位_推荐/加拿大快递邮编展示系统.exe" "$RELEASE_DIR/绿色版_64位_推荐/🚀加拿大快递邮编展示系统_64位.exe"
mv "$RELEASE_DIR/绿色版_32位_兼容/加拿大快递邮编展示系统.exe" "$RELEASE_DIR/绿色版_32位_兼容/🔧加拿大快递邮编展示系统_32位.exe"

# 计算文件大小
echo ""
echo "📊 版本文件大小统计："
echo "├── 智能安装包: $(du -h "$RELEASE_DIR/【推荐】加拿大快递邮编展示系统_安装包.exe" | cut -f1)"
echo "├── 64位绿色版: $(du -sh "$RELEASE_DIR/绿色版_64位_推荐" | cut -f1)"
echo "├── 32位绿色版: $(du -sh "$RELEASE_DIR/绿色版_32位_兼容" | cut -f1)"
echo "└── 总发布包: $(du -sh "$RELEASE_DIR" | cut -f1)"

echo ""
echo "✅ Windows兼容版本打包完成！"
echo "📁 发布目录: $RELEASE_DIR"
echo ""
echo "🎯 使用建议："
echo "1. 🏆 推荐使用: 【推荐】加拿大快递邮编展示系统_安装包.exe"
echo "2. 📱 备选方案: 根据系统选择对应的绿色版本"
echo "3. 📋 务必阅读: 📋Windows使用指南_请先阅读.txt"
echo ""
echo "🚀 现在您的同事可以在任何Windows电脑上使用了！" 