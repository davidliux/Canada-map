# FSA分区管理功能使用指南

## 功能概述

加拿大快递邮编展示系统现已新增完整的FSA分区管理功能，支持：

- **邮编分区绑定管理** - 为每个FSA分区绑定具体邮编
- **分区价格管理系统** - 按重量区间设置配送价格
- **数据导入导出** - 支持CSV/JSON格式的批量操作
- **本地数据存储** - 基于localStorage的数据持久化

## 核心功能

### 1. 邮编分区绑定管理

#### 功能特点
- 单个邮编添加和批量邮编导入
- 邮编格式验证（加拿大邮编格式：A1A 1A1）
- 邮编搜索和过滤
- 邮编列表导出

#### 使用方法
1. 在地图上点击任意FSA分区
2. 在弹出的管理面板中选择"邮编绑定"标签
3. 添加邮编：
   - 单个添加：在输入框中输入邮编（如V6B 1A1），点击添加
   - 批量导入：点击"批量导入"，粘贴多个邮编（每行一个或逗号分隔）
4. 管理邮编：
   - 搜索：使用搜索框过滤邮编
   - 删除：点击邮编右侧的删除按钮
   - 导出：点击"导出列表"下载邮编文件

### 2. 分区价格管理系统

#### 重量区间配置
系统提供13个默认重量区间：
- 0-11.000 KGS
- 11.001-15.000 KGS
- 15.001-20.000 KGS
- 20.001-25.000 KGS
- 25.001-30.000 KGS
- 30.001-35.000 KGS
- 35.001-40.000 KGS
- 40.001-45.000 KGS
- 45.001-50.000 KGS
- 50.001-55.000 KGS
- 55.001-60.000 KGS
- 60.001-64.000 KGS
- 64.000+ KGS

#### 价格管理功能
- **动态区间管理**：添加、编辑、删除重量区间
- **价格设置**：为每个区间设置配送价格（CAD）
- **区间启用/禁用**：灵活控制哪些区间生效
- **价格测试工具**：输入重量快速查看对应价格
- **重叠检测**：自动检测和警告重量区间重叠

#### 使用方法
1. 在FSA管理面板中选择"价格配置"标签
2. 编辑现有区间：
   - 点击区间右侧的编辑按钮
   - 修改最小重量、最大重量或价格
   - 点击保存确认修改
3. 添加新区间：
   - 点击"添加重量区间"
   - 输入最小重量、最大重量和价格
   - 系统会自动验证区间有效性
4. 测试价格：
   - 在右上角输入测试重量
   - 系统会显示对应的配送价格

### 3. 数据导入导出

#### 支持格式
- **JSON格式**：完整的配置数据，包含所有字段信息
- **CSV格式**：表格格式，可用Excel编辑

#### 导出功能
1. 点击顶部导航栏的"导入导出"按钮
2. 选择"导出数据"标签
3. 选择导出格式（JSON或CSV）
4. 选择导出范围（全部或指定FSA）
5. 点击对应按钮下载文件

#### 导入功能
1. 在导入导出面板选择"导入数据"标签
2. 点击文件上传区域选择文件
3. 支持的文件格式：.json 和 .csv
4. 系统会自动验证数据格式
5. 显示导入结果和错误信息

#### 示例文件
系统提供示例文件下载：
- JSON示例：包含完整的FSA配置结构
- CSV示例：展示正确的CSV格式

## 数据结构

### FSA配置对象
```javascript
{
  fsaCode: "V6B",           // FSA代码
  province: "BC",           // 省份
  region: "Vancouver",      // 地区
  postalCodes: [            // 绑定的邮编列表
    "V6B 1A1",
    "V6B 1A2"
  ],
  weightRanges: [           // 重量区间价格配置
    {
      id: "range_1",
      min: 0,
      max: 11.000,
      label: "0-11.000 KGS",
      price: 15.99,
      isActive: true
    }
  ],
  isActive: true,           // 是否启用配送
  lastUpdated: "2024-01-15T10:00:00.000Z",
  metadata: {
    createdAt: "2024-01-15T10:00:00.000Z",
    version: "1.0.0",
    notes: "备注信息"
  }
}
```

## 技术特性

### 数据验证
- **邮编格式验证**：确保符合加拿大邮编格式
- **重量区间验证**：检查区间有效性和重叠
- **价格验证**：确保价格为非负数值
- **数据完整性检查**：导入时验证所有必需字段

### 本地存储
- **自动保存**：配置修改后自动保存到localStorage
- **数据备份**：支持自动备份和手动备份
- **版本管理**：跟踪配置版本和修改历史
- **存储统计**：显示存储使用情况

### 用户体验
- **实时反馈**：操作结果即时显示
- **错误处理**：友好的错误提示和警告
- **响应式设计**：适配不同屏幕尺寸
- **动画效果**：流畅的界面过渡动画

## 使用场景

### 1. 新分区配置
1. 在地图上点击新的FSA分区
2. 添加该分区的邮编列表
3. 配置重量区间和价格
4. 保存配置

### 2. 批量数据管理
1. 使用导出功能下载现有配置
2. 在Excel中批量编辑CSV文件
3. 使用导入功能更新配置
4. 验证导入结果

### 3. 价格策略调整
1. 选择需要调整的FSA分区
2. 修改重量区间价格
3. 使用测试工具验证新价格
4. 保存并应用新策略

## 注意事项

1. **数据备份**：重要操作前建议先导出数据备份
2. **格式要求**：导入CSV时注意格式要求，可参考示例文件
3. **浏览器兼容**：建议使用现代浏览器以获得最佳体验
4. **数据限制**：localStorage有存储大小限制，大量数据建议分批处理

## 故障排除

### 常见问题
1. **邮编格式错误**：确保使用正确的加拿大邮编格式（A1A 1A1）
2. **重量区间重叠**：检查新增区间是否与现有区间重叠
3. **导入失败**：检查文件格式和数据完整性
4. **保存失败**：检查浏览器localStorage是否可用

### 技术支持
如遇到技术问题，请检查：
1. 浏览器控制台是否有错误信息
2. 网络连接是否正常
3. 浏览器是否支持localStorage
4. 文件格式是否正确

---

**版本信息**：v2.0.0 - FSA分区管理增强版  
**更新日期**：2024年1月15日  
**技术栈**：React + Vite + Leaflet + Tailwind CSS
